(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const Q=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),W=(e,{onPreviewPicture:t,onLikeIcon:n,onDeleteCard:o},r)=>{const s=Q(),a=s.querySelector(".card__like-button"),_=s.querySelector(".card__control-button_type_delete"),y=s.querySelector(".card__image"),c=s.querySelector(".card__like-count"),i=s.querySelector(".card__title");y.src=e.link,y.alt=e.name,i.textContent=e.name,c&&(c.textContent=e.likes?e.likes.length:0),e.likes&&e.likes.some(q=>q._id===r)&&a&&a.classList.add("card__like-button_is-active"),e.owner&&e.owner._id!==r&&_&&_.remove();const A=s.querySelector(".card__control-button_type_info");return A&&A.remove(),n&&a&&a.addEventListener("click",()=>n(a)),o&&_&&_.addEventListener("click",q=>{q.stopPropagation(),o()}),t&&y&&y.addEventListener("click",()=>t({name:e.name,link:e.link})),s},R=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");p(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",R)},p=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",R)},X=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{p(e)}),e.addEventListener("mousedown",n=>{n.target.classList.contains("popup")&&p(e)})};function u(e,t,n,o){const r=e.querySelector(`#${t.id}-error`);r.textContent=n,r.classList.add(o.errorClass),t.classList.add(o.inputErrorClass)}function H(e,t,n){const o=e.querySelector(`#${t.id}-error`);o.textContent="",o.classList.remove(n.errorClass),t.classList.remove(n.inputErrorClass)}function g(e,t,n){const o=t.value.trim();if(!o)return u(e,t,"Поле обязательно для заполнения",n),!1;if(t.classList.contains("popup__input_type_name")){if(o.length<2||o.length>40)return u(e,t,"Длина должна быть от 2 до 40 символов",n),!1;if(!/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(o)){const s=t.dataset.errorMessage||"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы";return u(e,t,s,n),!1}}if(t.classList.contains("popup__input_type_description")&&(o.length<2||o.length>200))return u(e,t,"Длина должна быть от 2 до 200 символов",n),!1;if(t.classList.contains("popup__input_type_card-name")){if(o.length<2||o.length>30)return u(e,t,"Длина должна быть от 2 до 30 символов",n),!1;if(!/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(o)){const s=t.dataset.errorMessage||"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы";return u(e,t,s,n),!1}}if(t.classList.contains("popup__input_type_url")||t.classList.contains("popup__input_type_avatar"))try{new URL(o)}catch{return u(e,t,"Введите корректную ссылку",n),!1}return H(e,t,n),!0}function Y(e,t){const n=e.querySelectorAll(t.inputSelector);return Array.from(n).map(r=>g(e,r,t)).some(r=>!r)}function j(e,t){const n=e.querySelector(t.submitButtonSelector);n&&(n.disabled=!0,n.classList.add(t.inactiveButtonClass))}function ee(e,t){const n=e.querySelector(t.submitButtonSelector);n&&(n.disabled=!1,n.classList.remove(t.inactiveButtonClass))}function k(e,t){Y(e,t)?j(e,t):ee(e,t)}function te(e,t){e.querySelectorAll(t.inputSelector).forEach(o=>{o.addEventListener("input",()=>{g(e,o,t),k(e,t)}),o.addEventListener("blur",()=>{g(e,o,t),k(e,t)})})}function E(e,t){e.querySelectorAll(t.inputSelector).forEach(o=>{H(e,o,t)}),j(e,t)}function oe(e){document.querySelectorAll(e.formSelector).forEach(n=>{te(n,e),k(n,e)})}const l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"86601be9-69ff-4794-8807-2f40ff4bca94","Content-Type":"application/json"}},d=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),z=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(d),D=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(d),ne=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(d),re=({avatar:e})=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(d),se=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(d),ce=(e,t)=>fetch(`${l.baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:l.headers}).then(n=>d(n)),ie=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(d),x=document.querySelector(".places__list"),B=document.querySelector(".popup_type_edit"),C=B.querySelector(".popup__form"),J=C.querySelector(".popup__input_type_name"),V=C.querySelector(".popup__input_type_description"),P=document.querySelector(".popup_type_new-card"),f=P.querySelector(".popup__form"),le=f.querySelector(".popup__input_type_card-name"),ae=f.querySelector(".popup__input_type_url"),T=document.querySelector(".popup_type_image"),F=T.querySelector(".popup__image"),ue=T.querySelector(".popup__caption"),pe=document.querySelector(".profile__edit-button"),de=document.querySelector(".profile__add-button"),w=document.querySelector(".profile__title"),I=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),U=document.querySelector(".popup_type_edit-avatar"),b=U.querySelector(".popup__form"),_e=b.querySelector(".popup__input"),$=document.querySelector(".popup_type_remove-card"),fe=$.querySelector(".popup__form"),me=document.querySelector(".header__logo"),v=document.querySelector(".popup_type_info"),ye=v.querySelector(".popup__title"),O=v.querySelector(".popup__info"),he=v.querySelector(".popup__text"),N=v.querySelector(".popup__list"),Se=document.getElementById("popup-info-definition-template"),be=document.getElementById("popup-info-user-preview-template");let S=null,h=null;const Z=({name:e,link:t})=>{F.src=t,F.alt=e,ue.textContent=e,m(T)},K=(e,t,n)=>{const o=t.classList.contains("card__like-button_is-active");ce(e,o).then(r=>{t.classList.toggle("card__like-button_is-active");const s=n.querySelector(".card__like-count");s&&(s.textContent=r.likes.length)}).catch(r=>{console.error("Ошибка при изменении лайка:",r)})},G=(e,t)=>{h={id:e,element:t},m($)},ve=e=>{if(e.preventDefault(),!h)return;const t=e.target.querySelector(".popup__button"),n=t.textContent;t.textContent="Удаление...",t.disabled=!0,ie(h.id).then(()=>{h.element.remove(),p($),h=null}).catch(o=>{console.error("Ошибка при удалении карточки:",o)}).finally(()=>{t.textContent=n,t.disabled=!1})},Ce=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),n=t.textContent;t.textContent="Сохранение...",t.disabled=!0,ne({name:J.value,about:V.value}).then(o=>{w.textContent=o.name,I.textContent=o.about,p(B)}).catch(o=>{console.error("Ошибка при обновлении профиля:",o)}).finally(()=>{t.textContent=n,t.disabled=!1})},Le=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),n=t.textContent;t.textContent="Сохранение...",t.disabled=!0,re({avatar:_e.value}).then(o=>{M.style.backgroundImage=`url(${o.avatar})`,p(U),b.reset()}).catch(o=>{console.error("Ошибка при обновлении аватара:",o)}).finally(()=>{t.textContent=n,t.disabled=!1})},qe=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),n=t.textContent;t.textContent="Создание...",t.disabled=!0,se({name:le.value,link:ae.value}).then(o=>{const r=W(o,{onPreviewPicture:Z,onLikeIcon:s=>K(o._id,s,r),onDeleteCard:S===o.owner._id?()=>G(o._id,r):null},S);x.prepend(r),p(P),f.reset()}).catch(o=>{console.error("Ошибка при создании карточки:",o)}).finally(()=>{t.textContent=n,t.disabled=!1})},ge=()=>{Promise.all([D(),z()]).then(([e,t])=>{const n=new Set;let o=0;const r={};e.forEach(c=>{n.add(c.owner._id),c.likes.forEach(i=>n.add(i._id)),o+=c.likes.length,c.likes.forEach(i=>{r[i._id]||(r[i._id]={count:0,name:i.name}),r[i._id].count++})});let s=0,a="Нет данных";Object.values(r).forEach(c=>{c.count>s&&(s=c.count,a=c.name||"Аноним")});const _=e.map(c=>({name:c.name,likes:c.likes.length})).sort((c,i)=>i.likes-c.likes).slice(0,3);ye.textContent="Статистика карточек",O.innerHTML="",N.innerHTML="",[{term:"Всего пользователей",description:n.size},{term:"Всего лайков",description:o},{term:"Максимально лайков от одного",description:s},{term:"Чемпион лайков",description:a}].forEach(c=>{const i=Se.content.cloneNode(!0);i.querySelector(".popup__info-term").textContent=c.term,i.querySelector(".popup__info-description").textContent=c.description,O.appendChild(i)}),he.textContent="Популярные карточки:",_.forEach(c=>{const i=be.content.cloneNode(!0);i.querySelector(".popup__list-item").textContent=c.name,N.appendChild(i)}),m(v)}).catch(e=>{console.error("Ошибка при загрузке статистики:",e)})};C.addEventListener("submit",Ce);f.addEventListener("submit",qe);b.addEventListener("submit",Le);fe.addEventListener("submit",ve);pe.addEventListener("click",()=>{J.value=w.textContent,V.value=I.textContent,m(B),E(C,L)});M.addEventListener("click",()=>{b.reset(),m(U),E(b,L)});de.addEventListener("click",()=>{f.reset(),m(P),E(f,L)});me.addEventListener("click",ge);const ke=document.querySelectorAll(".popup");ke.forEach(e=>{X(e)});const L={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};oe(L);Promise.all([D(),z()]).then(([e,t])=>{S=t._id,w.textContent=t.name,I.textContent=t.about,M.style.backgroundImage=`url(${t.avatar})`,x.innerHTML="",e.forEach(n=>{const o=W(n,{onPreviewPicture:Z,onLikeIcon:r=>K(n._id,r,o),onDeleteCard:S===n.owner._id?()=>G(n._id,o):null},S);x.append(o)})}).catch(e=>{console.error("Ошибка при загрузке данных:",e)});
