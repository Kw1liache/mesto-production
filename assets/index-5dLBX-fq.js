(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const Q=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),W=(e,{onPreviewPicture:t,onLikeIcon:r,onDeleteCard:o},n)=>{const s=Q(),a=s.querySelector(".card__like-button"),_=s.querySelector(".card__control-button_type_delete"),y=s.querySelector(".card__image"),c=s.querySelector(".card__like-count"),i=s.querySelector(".card__title");y.src=e.link,y.alt=e.name,i.textContent=e.name,c&&(c.textContent=e.likes?e.likes.length:0),e.likes&&e.likes.some(q=>q._id===n)&&a&&a.classList.add("card__like-button_is-active"),e.owner&&e.owner._id!==n&&_&&_.remove();const M=s.querySelector(".card__control-button_type_info");return M&&M.remove(),r&&a&&a.addEventListener("click",()=>r(a)),o&&_&&_.addEventListener("click",q=>{q.stopPropagation(),o()}),t&&y&&y.addEventListener("click",()=>t({name:e.name,link:e.link})),s},R=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");p(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",R)},p=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",R)},X=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{p(e)}),e.addEventListener("mousedown",r=>{r.target.classList.contains("popup")&&p(e)})};function u(e,t,r,o){const n=e.querySelector(`#${t.id}-error`);n.textContent=r,n.classList.add(o.errorClass),t.classList.add(o.inputErrorClass)}function j(e,t,r){const o=e.querySelector(`#${t.id}-error`);o.textContent="",o.classList.remove(r.errorClass),t.classList.remove(r.inputErrorClass)}function g(e,t,r){const o=t.value.trim();if(!o)return u(e,t,"Поле обязательно для заполнения",r),!1;if(t.classList.contains("popup__input_type_name")){if(o.length<2||o.length>40)return u(e,t,"Длина должна быть от 2 до 40 символов",r),!1;if(!/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(o)){const s=t.dataset.errorMessage||"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы";return u(e,t,s,r),!1}}if(t.classList.contains("popup__input_type_description")&&(o.length<2||o.length>200))return u(e,t,"Длина должна быть от 2 до 200 символов",r),!1;if(t.classList.contains("popup__input_type_card-name")){if(o.length<2||o.length>30)return u(e,t,"Длина должна быть от 2 до 30 символов",r),!1;if(!/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(o)){const s=t.dataset.errorMessage||"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы";return u(e,t,s,r),!1}}if(t.classList.contains("popup__input_type_url")||t.classList.contains("popup__input_type_avatar"))try{new URL(o)}catch{return u(e,t,"Введите корректную ссылку",r),!1}return j(e,t,r),!0}function Y(e,t){const r=e.querySelectorAll(t.inputSelector);return Array.from(r).map(n=>g(e,n,t)).some(n=>!n)}function z(e,t){const r=e.querySelector(t.submitButtonSelector);r&&(r.disabled=!0,r.classList.add(t.inactiveButtonClass))}function ee(e,t){const r=e.querySelector(t.submitButtonSelector);r&&(r.disabled=!1,r.classList.remove(t.inactiveButtonClass))}function k(e,t){Y(e,t)?z(e,t):ee(e,t)}function te(e,t){e.querySelectorAll(t.inputSelector).forEach(o=>{o.addEventListener("input",()=>{g(e,o,t),k(e,t)}),o.addEventListener("blur",()=>{g(e,o,t),k(e,t)})})}function E(e,t){e.querySelectorAll(t.inputSelector).forEach(o=>{j(e,o,t)}),z(e,t)}function oe(e){document.querySelectorAll(e.formSelector).forEach(r=>{te(r,e),k(r,e)})}const l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"86601be9-69ff-4794-8807-2f40ff4bca94","Content-Type":"application/json"}},d=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),D=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(d),J=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(d),re=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(d),ne=({avatar:e})=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(d),se=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(d),ce=(e,t)=>fetch(`${l.baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:l.headers}).then(r=>d(r)),ie=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(d),x=document.querySelector(".places__list"),B=document.querySelector(".popup_type_edit"),C=B.querySelector(".popup__form"),V=C.querySelector(".popup__input_type_name"),H=C.querySelector(".popup__input_type_description"),P=document.querySelector(".popup_type_new-card"),f=P.querySelector(".popup__form"),le=f.querySelector(".popup__input_type_card-name"),ae=f.querySelector(".popup__input_type_url"),w=document.querySelector(".popup_type_image"),F=w.querySelector(".popup__image"),ue=w.querySelector(".popup__caption"),pe=document.querySelector(".profile__edit-button"),de=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),U=document.querySelector(".profile__image"),$=document.querySelector(".popup_type_edit-avatar"),b=$.querySelector(".popup__form"),_e=b.querySelector(".popup__input"),A=document.querySelector(".popup_type_remove-card"),fe=A.querySelector(".popup__form"),me=document.querySelector(".header__logo"),v=document.querySelector(".popup_type_info"),ye=v.querySelector(".popup__title"),O=v.querySelector(".popup__info"),he=v.querySelector(".popup__text"),N=v.querySelector(".popup__list"),Se=document.getElementById("popup-info-definition-template"),be=document.getElementById("popup-info-user-preview-template");let S=null,h=null;const Z=({name:e,link:t})=>{F.src=t,F.alt=e,ue.textContent=e,m(w)},K=(e,t,r)=>{const o=t.classList.contains("card__like-button_is-active");ce(e,o).then(n=>{t.classList.toggle("card__like-button_is-active");const s=r.querySelector(".card__like-count");s&&(s.textContent=n.likes.length)}).catch(n=>{console.error("Ошибка при изменении лайка:",n)})},G=(e,t)=>{h={id:e,element:t},m(A)},ve=e=>{if(e.preventDefault(),!h)return;const t=e.target.querySelector(".popup__button"),r=t.textContent;t.textContent="Удаление...",t.disabled=!0,ie(h.id).then(()=>{h.element.remove(),p(A),h=null}).catch(o=>{console.error("Ошибка при удалении карточки:",o)}).finally(()=>{t.textContent=r,t.disabled=!1})},Ce=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),r=t.textContent;t.textContent="Сохранение...",t.disabled=!0,re({name:V.value,about:H.value}).then(o=>{I.textContent=o.name,T.textContent=o.about,p(B)}).catch(o=>{console.error("Ошибка при обновлении профиля:",o)}).finally(()=>{t.textContent=r,t.disabled=!1})},Le=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),r=t.textContent;t.textContent="Сохранение...",t.disabled=!0,ne({avatar:_e.value}).then(o=>{U.style.backgroundImage=`url(${o.avatar})`,p($),b.reset()}).catch(o=>{console.error("Ошибка при обновлении аватара:",o)}).finally(()=>{t.textContent=r,t.disabled=!1})},qe=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),r=t.textContent;t.textContent="Создание...",t.disabled=!0,se({name:le.value,link:ae.value}).then(o=>{const n=W(o,{onPreviewPicture:Z,onLikeIcon:s=>K(o._id,s,n),onDeleteCard:S===o.owner._id?()=>G(o._id,n):null},S);x.prepend(n),p(P),f.reset()}).catch(o=>{console.error("Ошибка при создании карточки:",o)}).finally(()=>{t.textContent=r,t.disabled=!1})},ge=()=>{Promise.all([J(),D()]).then(([e,t])=>{const r=new Set;let o=0;const n={};e.forEach(c=>{r.add(c.owner._id),c.likes.forEach(i=>r.add(i._id)),o+=c.likes.length,c.likes.forEach(i=>{n[i._id]||(n[i._id]={count:0,name:i.name}),n[i._id].count++})});let s=0,a="Нет данных";Object.values(n).forEach(c=>{c.count>s&&(s=c.count,a=c.name||"Аноним")});const _=e.map(c=>({name:c.name,likes:c.likes.length})).sort((c,i)=>i.likes-c.likes).slice(0,3);ye.textContent="Статистика карточек",O.replaceChildren(),N.replaceChildren(),[{term:"Всего пользователей",description:r.size},{term:"Всего лайков",description:o},{term:"Максимально лайков от одного",description:s},{term:"Чемпион лайков",description:a}].forEach(c=>{const i=Se.content.cloneNode(!0);i.querySelector(".popup__info-term").textContent=c.term,i.querySelector(".popup__info-description").textContent=c.description,O.appendChild(i)}),he.textContent="Популярные карточки:",_.forEach(c=>{const i=be.content.cloneNode(!0);i.querySelector(".popup__list-item").textContent=c.name,N.appendChild(i)}),m(v)}).catch(e=>{console.error("Ошибка при загрузке статистики:",e)})};C.addEventListener("submit",Ce);f.addEventListener("submit",qe);b.addEventListener("submit",Le);fe.addEventListener("submit",ve);pe.addEventListener("click",()=>{V.value=I.textContent,H.value=T.textContent,m(B),E(C,L)});U.addEventListener("click",()=>{b.reset(),m($),E(b,L)});de.addEventListener("click",()=>{f.reset(),m(P),E(f,L)});me.addEventListener("click",ge);const ke=document.querySelectorAll(".popup");ke.forEach(e=>{X(e)});const L={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};oe(L);Promise.all([J(),D()]).then(([e,t])=>{S=t._id,I.textContent=t.name,T.textContent=t.about,U.style.backgroundImage=`url(${t.avatar})`,x.replaceChildren(),e.forEach(r=>{const o=W(r,{onPreviewPicture:Z,onLikeIcon:n=>K(r._id,n,o),onDeleteCard:S===r.owner._id?()=>G(r._id,o):null},S);x.append(o)})}).catch(e=>{console.error("Ошибка при загрузке данных:",e)});
